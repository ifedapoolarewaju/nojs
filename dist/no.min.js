"use strict";!function(){function e(e){this.targetTypes={},this.templates={}}function t(e){var t=e.toLowerCase();no.targetTypes[t]={},no.targetTypes[t].process=function(e,t){("trigger"!==e.actionType||t.length>0)&&(e.invalid=!0)},no.targetTypes[t].apply=function(t,n,a){a[e]()}}e.prototype.splitParams=function(e){if(null==e)return null;for(var t=[],n="",a=!1,o=!1,i=!1,s=!1,r=!0,l=0;l<e.length;l++){var p=e.charAt(l);if(s){if("'"!==p&&"\\"!==p&&!/\s/.exec(p))return"invalid";n+=p,s=!1,r=!1,o=!1,i=!1}else if(!r&&!o&&a||"'"!==p)if(a&&"'"===p)a=!1,i=!0,t.push(n),n="";else if(!a&&/\s/.exec(p))r||o||i||(t.push(n),n=""),o=!0,i=!1;else if("\\"===p)s=!0,r=!1,o=!1,i=!1;else{if(i)return"invalid";r=!1,o=!1,i=!1,n+=p}else{if(!r&&!o)return"invalid";a=!0,r=!1,o=!1}}return a?"invalid":(i||o||r||t.push(n),t)},e.prototype.processTrigger=function(e,t){var n={};return n.eventType=e.shift(),n.invalid=!1,"timeout"===e[0]?(e.shift(),n.timeout={},n.timeout.time=parseInt(t.shift()),n.timeout.count=parseInt(t.shift()),(isNaN(n.timeout.time)||isNaN(n.timeout.count))&&(n.invalid=!0)):n.timeout=null,n},e.prototype.processAction=function(e,t,n){var a={};a.actionType=e.shift(),a.targetType=e.shift().toLowerCase(),a.sourceElement=n,a.isSelf="self"===e[e.length-1],a.isSelf?a.target=n:a.target=t.shift(),a.invalid=!1;var o=this.targetTypes[a.targetType];return null==a.actionType||null==a.targetType||null==o||null==a.target?a.invalid=!0:o.process(a,t),a},e.prototype.processListener=function(e,t,n){var a=this.targetTypes[t.targetType];if(null!=a){var o=function(e){if(t.isSelf)a.apply(e,t,t.target);else{document.querySelectorAll(t.target).forEach(function(n){a.apply(e,t,n)})}},i=null;if(null==e.timeout)i=o;else if(e.timeout.count>0){var s=e.timeout.count;i=function(t){s-- >0?(o(t),setTimeout(i,e.timeout.time)):s=e.timeout.count}}else i=function(t){setInterval(function(){o(t)},e.timeout.time)};"immediately"===e.eventType?setTimeout(function(){i(null)}):n.addEventListener(e.eventType,i)}},e.prototype.templateArgs=function(e,t){for(var n=0;n<e.length;n++)for(var a=0;a<t.length;a++){var o=new RegExp("\\$"+a,"g");e[n]=e[n].replace(o,t[a])}},e.prototype.processTemplate=function(e,t){var n=this.splitParams(t);"invalid"===n&&console.warn('invalid no-js template no-js="'+t+'"');var a=this.templates[n.shift()];null!=a&&a.argc===n.length||console.warn('invalid no-js template no-js="'+t+'"');for(var o=0;o<a.copyActions.length;o++){var i=a.copyActions[o].keyStr.split("-");i.shift();var s=this.splitParams(a.copyActions[o].valStr);this.templateArgs(s,n);var r=this.processTrigger(i,s),l=this.processAction(i,s,e);l.invalid||r.invalid?console.warn('invalid no-js template no-js="'+t+'"'):this.processListener(r,l,e)}},e.prototype.processElement=function(e){var t=this;Object.keys(e.attributes).forEach(function(n){var a=e.attributes[n],o=!1;if("no-js"===a.name&&null!=a.value&&""!==a.value)return void t.processTemplate(e,a.value);if(0===a.name.indexOf("on--"))o=!0,console.warn('Deprecation warning: using double dashes "--" are deprecated. Use a single dash "-" instead.');else if(0!==a.name.indexOf("on-"))return;var i=a.name.split(o?"--":"-");i.shift();var s=t.splitParams(a.value);"invalid"===s&&console.warn("invalid no-js parameter "+a.name+'="'+a.value+'"');var r=t.processTrigger(i,s),l=t.processAction(i,s,e);l.invalid||r.invalid?console.warn("invalid no-js attribute "+a.name+'="'+a.value+'"'):t.processListener(r,l,e)})},e.prototype.processMeta=function(e){var t={};t.copyActions=[],t.applyActions=[];var n=null;Object.keys(e.attributes).forEach(function(a){var o=e.attributes[a];if("no-js"==o.name)n=o.value;else if(0===o.name.indexOf("on-")){var i={};i.keyStr=o.name,i.valStr=o.value,t.copyActions.push(i)}else{var s={};s.keyStr=o.name,s.valStr=o.value,t.applyActions.push(s)}});var a=this.splitParams(n);null!=a&&2===a.length&&(t.argc=parseInt(a[1])),null==t.argc||isNaN(t.argc)||null!=this.templates[a[0]]?(console.warn("invalid no-js meta template"),console.warn(e)):this.templates[a[0]]=t},e.prototype.js=function(e){var t=this;e=e||"html",document.querySelector(e).querySelectorAll("[no-js]").forEach(function(e){"meta"===e.tagName.toLowerCase()?t.processMeta(e):t.processElement(e)})},window.no=new e,no.targetTypes.attribute={},no.targetTypes.attribute.process=function(e,t){"add"===e.actionType||"set"===e.actionType?t.length>=2?(e.attributeName=t.shift(),e.attributeValue=t.join(" ")):e.invalid=!0:"remove"===e.actionType&&1===t.length?e.attributeName=t.shift():e.invalid=!0},no.targetTypes.attribute.apply=function(e,t,n){"remove"===t.actionType?n.removeAttribute(t.attributeName):n.setAttribute(t.attributeName,t.attributeValue)},no.targetTypes.class={},no.targetTypes.class.process=function(e,t){"add"===e.actionType||"set"===e.actionType||"remove"===e.actionType||"toggle"===e.actionType||"switch"===e.actionType?e.classNames=t:e.invalid=!0},no.targetTypes.class.apply=function(e,t,n){"set"===t.actionType?n.className=t.classNames.join(" "):"switch"===t.actionType?t.classNames.forEach(function(e){n.classList.remove(e),t.sourceElement.classList.add(e)}):t.classNames.forEach(function(e){n.classList[t.actionType](e)})},no.targetTypes.id={},no.targetTypes.id.process=function(e,t){e.targetType="attribute",t.unshift("id"),no.targetTypes.attribute.process(e,t)},no.targetTypes.dom={},no.targetTypes.dom.process=function(e,t){"remove"!==e.actionType&&0!=t.length&&e.invalid},no.targetTypes.dom.apply=function(e,t,n){"remove"===t.actionType&&n.remove()},no.targetTypes.value={},no.targetTypes.value.process=function(e,t){"set"===e.actionType?e.value=t.join(" "):"reset"===e.actionType&&0===t.length||(e.invalid=!0)},no.targetTypes.value.apply=function(e,t,n){"set"===t.actionType?n.value=t.value:"reset"===t.actionType&&(n.value=null)},no.targetTypes.text={},no.targetTypes.text.process=function(e,t){"set"===e.actionType?e.text=t.join(" "):"copy"===e.actionType?e.source=t.shift():e.invalid=!0},no.targetTypes.text.apply=function(e,t,n){"set"===t.actionType?n.innerText=t.text:"copy"===t.actionType&&(n.innerText=document.querySelector(t.source).innerText)},no.targetTypes.html={},no.targetTypes.html.process=function(e,t){"set"===e.actionType?e.html=t.join(" "):"copy"===e.actionType?e.source=t.shift():e.invalid=!0},no.targetTypes.html.apply=function(e,t,n){"set"===t.actionType?n.innerHTML=t.html:"copy"===t.actionType&&(n.innerHTML=document.querySelector(t.source).innerHTML)},t("click"),t("focus"),t("blur"),t("scrollIntoView"),no.targetTypes.template={},no.targetTypes.template.process=function(e,t){"apply"===e.actionType?(e.template=e.target,e.target=e.sourceElement,e.isSelf=!0,e.args=t):e.invalid=!0},no.targetTypes.template.apply=function(e,t,n){for(var a=no.templates[t.template],o=0;o<a.applyActions.length;o++){var i=a.applyActions[o].keyStr.split("-"),s=no.splitParams(a.applyActions[o].valStr);no.templateArgs(s,t.args);var r=no.processAction(i,s,n);r.isSelf?no.targetTypes[r.targetType].apply(e,r,n):document.querySelectorAll(r.target).forEach(function(t){no.targetTypes[r.targetType].apply(e,r,t)})}},no.targetTypes.form={},no.targetTypes.form.process=function(e,t){e.form=e.target,e.property=t.shift(),e.target=e.sourceElement,e.isSelf=!0,"set"===e.actionType?e.value=t.join(" "):"reset"!==e.actionType&&(e.invalid=!0)},no.targetTypes.form.apply=function(e,t,n){var a=document.forms[t.form][t.property];"set"===t.actionType?"checkbox"===a.type?"true"===t.value||"yes"===t.value||"checked"===t.value||"on"===t.value?a.checked=!0:a.checked=!1:a.value=t.value:"checkbox"===a.type?a.checked=!1:a.value=null},document.addEventListener("DOMContentLoaded",function(){no.js()})}();